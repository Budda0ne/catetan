---
categories: [arsip]
title: "Tutorial Memaksa Jaringan Mikrotik Memakai OpenDNS Sebagai DNS Resolver"
date: "2019-06-21T14:58:00.001+07:00"
# author: Phate Holloway
tags:
 - DNS Resolver
 - Indihome
 - Mikrotik
 - TKJ
 - Internet
 - OpenDNS
last_modified_at: "2019-10-12T17:10:46.256+07:00"
header:
 image: https://1.bp.blogspot.com/-DyDcXIEHuCg/XQyQzUefwxI/AAAAAAAAPfg/-yiYyVcpptk-hb79N6S9jT5B5FrNsxmEACLcBGAs/w480/OpenDNS_logo.png
# blogger_id: tag:blogger.com,1999:blog-8168996750712797250.post-3025550720581706360
redirect_from:
 - /2019/06/tutorial-cara-paksa-mikrotik-pakai-open-dns.html
---

<p><b>KnoAcc.Org</b> — ISP di Indonesia ini sungguh unik dan kejam. Beberapa ISP diketahui menggunakan dns redirect, dengan membelokkan permintaan ke DNS ISP itu sendiri. Padahal, kita terkadang perlu mengganti DNS dengan <i>dns public</i> sesuai dengan yang kita inginkan. </p><noscript><img border="0" src="https://1.bp.blogspot.com/-DyDcXIEHuCg/XQyQzUefwxI/AAAAAAAAPfg/-yiYyVcpptk-hb79N6S9jT5B5FrNsxmEACLcBGAs/s1600/OpenDNS_logo.png" data-original-width="720" data-original-height="285" alt="Paksa Open DNS pada jaringan Mikrotik"/></noscript><p>ISP tersebut meng-<i>intercept</i> semua paket yang melewati port 53. Jadi usaha untuk mengganti DNS resolver pada jaringan supaya sesuai dengan yang kita inginkan pun malah menjadi sia-sia. Karena ulah beberapa ISP tersebut, permintaan yang seharusnya diteruskan ke DNS yang kita gunakan (misal: DNS Google; 8.8.8.8) malah dibelokkan ke alamat DNS lain milik ISP. </p><h3>Cara Memaksakan OpenDNS di MikroTik</h3><p>Kenapa OpenDNS? Karena OpenDNS merupakan salah satu DNS tercepat. Dan yang paling penting kita bisa melakukan <i>filtering</i>. Yakni memilih kategori situs apa saja yang ingin kita blokir. Misalnya saja: situs p*rn0, adware, web spam, dan lain-lain. Jika tidak ingin repot, kamu juga boleh memilih untuk tidak melakukan pemblokiran dan <a href="https://www.catetan.pw/2019/04/cara-mendapatkan-user-dan-pasword-router-mikrotik.html">membuka akses</a> semua situs. </p><amp-ad width="100vw" height="320"x20x20x20type="adsense"      data-ad-client="ca-pub-8526606076277673"      data-ad-slot="3999949533"      data-auto-format="rspv"      data-full-width>  <div overflow></div></amp-ad><p>Untuk bisa memblokir situs tertentu, perlu akun OpenDNS kemudian mengaturnya dari dashboard. Silahkan membuat akun dan masuk ke situs OpenDNS <a href="https://www.opendns.com">di sini</a>. Pada dashboard akun, kamu akan menemukan <strong>Web Content Filtering</strong> pada menu <b>Setting</b>. </p><p>Kembali ke Mikrotik. Sebelum melakukan pengaturan, pastikan kamu tidak mencentang <b>Use peer DNS</b> pada sumber internet kamu. Lihat dan sesuaikan sperti gambar di bawah ini: </p><p>Perhatikan juga hal-hal berikut:<ul>1. Apabila kamu terhubung ke modem dengan PPOE Client, maka hapus centang seperti gambar dibawah: <figure><img src="https://1.bp.blogspot.com/-B-W5YTjUDjQ/XQ04GqeV6wI/AAAAAAAAPhI/1VqIpetv3gkUuTyDRJypJ4RlDfsGxUvdgCPcBGAYYCw/s1600/ppoe-client.PNG" width="599" height="486" layout="responsive" data-original-width="599" data-original-height="486" noloading alt="Gambar untuk PPOE Client"></amp-img><figcaption>Hapus centang untuk PPOE Client</figcaption></figure>2. Apabila kamu terhubung ke modem dengan DHCP Client, maka hapus centang seperti gambar dibawah: <figure><img src="https://3.bp.blogspot.com/-3hRlV7PjWzQ/XQ04GTN7j0I/AAAAAAAAPhE/LQ4_bZu3IiMIfLVTW5O4wj3zu-v-ZlInACPcBGAYYCw/s1600/dhcp-client.PNG" width="603" height="491" data-original-width="603" data-original-height="491" layout="responsive" no loading alt="Gambar untuk DHCP Client"></amp-img><figcaption>Hapus centang untuk DHCP Client</figcaption></figure></ul></p><p>Sekarang kita lakukan setting pada Mikrotik agar menggunaka OpenDNS. Kamu bisa memakai skrip di bawah ini pada terminal WinBox. Salin, kemudian Tempel pada jendela Terminal di Winbox  </p><pre><br />/ip dns set allow-remote-requests=yes servers=208.67.222.222,208.67.220.220<br/><br />/ip firewall nat add action=dst-nat chain=dstnat comment=OpenDNS dst-port=53,5353 protocol=udp to-addresses=208.67.222.222 to-ports=5353<br /></pre><p>Dengan skrip di atas, kamu akan akan memaksa semua klien/perangkat yang terkoneksi dengan mikrotik anda agar memakai OpenDNS sebagai DNS resolver dan memindahkan semua paket yang lewat port 53 ke port 5353 agar lolos dari cegatan ISP. </p><p class="notice"><i>Tambahan: jika ingin lebih aman, kamu bisa pakai port 443 alih-alih memakai 5353 karena OpenDNS juga mendukung DNS over https.</i><p>Lihat pada menu <b>IP – Firewall – NAT</b>. Pastikan settingan dengan comment <b>OpenDNS</b> berada di atas <i>masquerade</i>. Jika kamu menggunakan Mikrotik sebagai server hotspot, tetap letakkan rule <i>NAT OpenDNS</i> di atas <i>masquerade</i> tapi berada dibawah <i>NAT Hotspot</i>. Lihat dan atur agar seperti gambar di bawah ini: </p><figure><img layout="responsive" width="640" height="340" src="https://i0.wp.com/www.ramitan.com/wp-content/uploads/2018/04/opendns.png?resize=640,340" alt="Gambar urutan NAT OpenDNS, masquerade dan NAT Hotspot"></amp-img><figcaption>Urutan NAT OpenDNS, masquerade dan NAT Hotspot</figcaption></figure><p>Apabila anda memakai IP Publik statis maka pengaturan selesai sampai disini. </p><h3>Pengaturan Lanjutan</h3><p>Untuk IP publik dinamis seperti pelanggan Indihome sebenarnya tidak perlu pengaturan lanjutan. Tetapi jika kamu ingin melakukan <i>filtering</i> seperti p*rn*grafi, j*di, atau situs kategori tertentu melalui dashboard OpenDNS seperti yang disebut di awal artikel, kamu perlu melakukan pengaturan lanjutan dengan cara yang akan dijelaskan berikut ini: </p><p>Karena menggunakan IP publik dinamis yang berubah-ubah, maka OpenDNS tidak bisa mengunci alamat IP publik jaringan kamu. Sehingga permintaan yang datang dari IP publik kamu yang baru, tidak akan difilter sesuai yang kamu atur dari dasboard akun OpenDNS. </p><p>Jadi perlu ada tambahan pengaturan agar OpenDNS bisa mengenali IP publik kamu yang baru. Buka menu <b>System – Script</b> dan buat script baru dengan nama "opendns" kemudian ketik (salin dan tempel) script berikut; <pre><br /># Rubah nilai di bagian ini sesuai dengan akun opendns kamu<br/><br /># Update-only password (didapatkan dari OpenDNS Support). Dengan two-factor authentication aktif, dibutuhkan pemakaian update only password.<br /><br/><br/><br />:local odnsuser <b>"namauseropendnskamu"</b><br/><br />:local odnspass <b>"passwordopendnskamu"</b><br /><br/><br/><br /># Atur hostname atau label jaringan yang akan diupdate. Ini adalah nama jaringan OpenDNS yang ada di dashboard.<br/><br /># Jangan gunakan spasi untuk Hostname. Ganti nilai dalam tanda kutip sesuai hostname.<br/> <br /># Hanya mendukung satu host.<br/><br/><br /># Gunakan "all.dnsomatic.com" untuk matichost update semua item pada dnsomatic dengan IP ini. <br/><br /># Ingat, kamu harus punya akses sebagai admin atau edit (Read/Write/Grant pada dashboard OpenDNS) untuk memperbarui alamat IP.<br /><br/><br/><br />:local odnshost "<b>namahostopendnskamu</b>"<br /><br/><br/><br /># Ganti menjadi nama interface yang akan mendapatkan perubahan alamat IP<br/><br /># Tidak berpengaruh pada nomor model kamu  - memberi komentar pada baris ini mungkin masih bisa untuk perangkat interfacr tunggal atau jika tidak tersedia pada DNS-O-Matic script yang sedang dipaki.<br /><br/><br/><br />:local inetinterface "<b>ether1</b>"<br /><br/><br/><br /># Tak ada perubahan yang perlu dilakukan dibaris berikut<br /><br/><br/><br />:global previousIP;<br/><br />:log info "Mendapatkan IP yang baru"<br /><br/><br/><br /># Mendapatkan IP publik saat ini melalui layanan DNS-O-Matic dan menyimpan dalam bentuk txt<br /><br/><br/><br />/tool fetch url="http://myip.dnsomatic.com/" mode=http dst-path=IPpublik.txt<br /><br/><br/><br /># Membaca IP publik saat ini dari file txt dan menjadikannya sebagai variable currentIP.<br /><br/><br/><br />:local currentIP [/file get IPpublik.txt contents]<br/><br />:log info "IP baru yang didapatkan $currentIP"<br /><br/><br/><br /># Optional, hanya memeriksa dan dijalankan jika IP sudah ganti satu baris kode: :if<br/><br /># untuk disable, atur baris pertama menjadi ":if ($currentIP != 1) do={"<br /><br/><br/><br />:if ($currentIP != $previousIP) do={<br/><br />:log info "OpenDNS: perlu ada pembaruan"<br/><br />:set previousIP $currentIP<br /><br/><br/><br /># URL pembaruan. Teks "\3F" adalah nilai hex dari tanda tanya (?). Diperlukan karena (?) adalah karakter khusus dalam perintah.<br/><br /># Beberapa versi MicroTik/WinBox OS lama membutuhkan baris berikut (http) sedangkan versi baru membutuhkan https.<br /><br/><br/><br /># :local url "http://updates.opendns.com/nic/update\3Fhostname=$odnshost"<br/><br />:local url "https://updates.opendns.com/nic/update\3Fhostname=$odnshost"<br/><br />:log info "OpenDNS: Mengirim pembaruan ke $odnshost"<br/><br />/tool fetch url=($url) user=$odnsuser password=$odnspass mode=http dst-path=("/net_odns.txt")<br/><br />:delay 2;<br/><br/><br />local odnsReply [/file get net_odns.txt contents];<br /><br/><br />:log info "OpenDNS update selesai."<br /><br/><br />:log info "Balasan OpenDNS $odnsReply";<br /> } else={<br /><br/><br />:log info "OpenDNS: IP lama $previousIP and IP baru sama, tak perlu lakukan update" }<br /></pre></p><p>Sebelum menyimpan skrip di atas, lakukan penyesuaian terlebih dulu. Rubah HANYA pada tulisan yang ditulis <b>tebal</b>. Cari pada bagian <em>namauseropendnskamu</em>, <em>passwordopendnskamu</em>, <em>namahostopendnkamu</em>. Kemudian sesuaikan <code>:local inetinterface “ether1”</code> sesuai dengan port yang menjadi sumber internet (port ke modem Indihome) pada Mikrotik kamu, dan simpan skrip di atas dengan nama “opendns” </p><p><amp-ad width="100vw" height="320"      type="adsense"      data-ad-client="ca-pub-8526606076277673"      data-ad-slot="1894657537"      data-auto-format="rspv"      data-full-width="">  <div overflow=""></div></amp-ad></p><p>Langkah terakhir kamu bisa membuat <i>scheduler</i> untuk melakukan update IP secara otomatis setiap <i>reboot</i> dan setiap 5 menit dengan skrip berikut: <pre><br />/system scheduler add name="opendns startup" on-event="system script run opendns" policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive,romon start-time=startup add interval=5m name="opendns 5m" on-event="system script run opendns" policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive,romon start-time=startup<br /></pre><p>Hasil update penggantian IP publik dari script yang dibuat nantinya bisa dilihat dari menu <b>Log</b> baik dari Winbox (PC Windows) maupun aplikasi <b>MikroTik</b> (ponsel Android). Hasilnya kurang lebih seperti gambar di bawah</p><figure><img layout="responsive" src="https://4.bp.blogspot.com/-8me09SzGNmA/XRYpySm9_LI/AAAAAAAAP40/uHQ3t8jWMkYmMe5fX4ijXbOxhD5JC8U7wCLcBGAs/s1600/Screenshot_2019-06-28-21-47-11-450_com.mikrotik.android.tikapp.png" width="1600" height="800" ></amp-img><figcaption>Log info update IP Publik yang dikirim ke openDNS</figcaption></figure><p>Itulah cara memaksa Mikrotik memakai OpenDNS sebagai DNS dalam jaringan. Dengan melakukan setting yang di paparkan di atas, kamu bisa memaksa agar seluruh jaringan yang terhubung ke mikrotik memakai OpenDNS sebagai DNS resolver. Tidak perduli DNS yang dipakai perangkat dalam jaringan berbeda (misal DNS Google atau Telkom), tetap akan dibelokkan ke OpenDNS.</p>